# 10. instagram data map visualizing (ì¸ìŠ¤íƒ€ í¬ë¡¤ë§ ë§µìœ¼ë¡œ ë¹„ì£¼ì–¼ë¼ì´ì§•)

- íŒŒì¼ ë°›ì•„ì˜¤ê¸° ì£¼ì†Œ : https://github.com/Play-with-data/datasalon/tree/master/02_%EA%B0%9C%EC%A0%95%ED%8C%90/5_Jeju_Hotplace

## 10.1. ë°ì´í„° ì¤€ë¹„

#### 10.1.1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

```python
# 9. í¬ìŠ¤íŒ…ì—ì„œ ì €ì¥í•œ í¬ë¡¤ë§ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
import pandas as pd
raw_total = pd.read_excel('./files/1_crawling_raw.xlsx')
raw_total.head()
'''
	content	data	like	place	tags
0	ì œì£¼ë„ ë„ì°©~~ê³µí•­ê·¼ì²˜ #ì œì£¼ë¶„ì‹ ì—ì„œ ë¨¹ì€ ì²«ì‹ì‚¬ë§Œì¡±ë§Œì¡±!#ì œì£¼ë§›ì§‘#ì œì£¼ë„ë§›ì§‘#ì œ...	2019-01-01	705	NaN	['#ì œì£¼ë¶„ì‹', '#ì œì£¼ë§›ì§‘', '#ì œì£¼ë„ë§›ì§‘', '#ì œì£¼ë§›ì§‘ì¶”ì²œ', '#ì œì£¼ë„ë§›...
1	ï»¿#í•¨ë•ë§›ì§‘ ë¬´ê±°ë²„ê±° ë°”ë‹¤ ë³´ë©´ì„œ ë¨¹ìœ¼ë‹ˆê¹Œ ë” ê¿€ë§›ğŸ‘ğŸ» #ì œì£¼ë„ì¹´í˜íˆ¬ì–´#ì œì£¼ì¼ìƒ#í•¨...	2019-01-01	384	NaN	['#í•¨ë•ë§›ì§‘', '#ì œì£¼ë„ì¹´í˜íˆ¬ì–´', '#ì œì£¼ì¼ìƒ', '#í•¨ë•', '#jejudo...
2	.ëŒ€ë§Œì¡± ì œì£¼ìŠ¤!.#ë™ë¬¸ì‹œì¥#ì œì£¼ë™ë¬¸ì‹œì¥#ì œì£¼ë„ê¸°ë…í’ˆ#ì œì£¼ê¸°ë…í’ˆ#ì œì£¼ìŠ¤ëŠ”ì™„ë²½#ì œì£¼ë„...	2019-01-01	595	NaN	['#ë™ë¬¸ì‹œì¥', '#ì œì£¼ë™ë¬¸ì‹œì¥', '#ì œì£¼ë„ê¸°ë…í’ˆ', '#ì œì£¼ê¸°ë…í’ˆ', '#ì œì£¼...
3	#ì œì£¼ì—¬í–‰#2ì¼ì°¨ë¬´ê±°ë²„ê±° ì œì£¼ì™€ì„œ ë¨¹ì€ê²ƒì¤‘ì— ì œì¼ ë§›ìˆì—ˆìŒ!#ì œì£¼ë„ì—¬í–‰#ì œì£¼ë§›ì§‘#í•¨...	2019-01-01	412	NaN	['#ì œì£¼ì—¬í–‰', '#2ì¼ì°¨ë¬´ê±°ë²„ê±°', '#ì œì£¼ë„ì—¬í–‰', '#ì œì£¼ë§›ì§‘', '#í•¨ë•ë§›...
4	ğŸ¥‡1ì›” ì˜ì—… ì•ˆë‚´ğŸ¥‡-1ì›” 2ì¼, 3ì¼(ìˆ˜,ëª©)ì€ ì‰¬ì–´ê°‘ë‹ˆë‹¤-1ì›” 4ì¼,5ì¼,6ì¼(ê¸ˆ...	2019-01-01	364	ë¡œíƒ€ë¦¬ê³¼ìì 	[]
'''
```

#### 10.1.2. ìœ„ì¹˜ ì •ë³´ ê°€ì €ì˜¤ê¸°

```python
location_counts = raw_total['place'].value_counts()
type(location_counts)
'''
pandas.core.series.Series
'''
```

#### 10.1.3. ìœ„ì¹˜ì •ë³´ë³„ ë¹ˆë„ìˆ˜ ë°ì´í„°

```python
location_counts_df = pd.DataFrame(location_counts)
location_counts_df
'''
	place
Jeju	241
Jeju-do	172
Jungle Book by Alice	101
Seogwipo	65
ì œì£¼ë„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë°•ë¬¼ê´€	59
...	...
ì—ì½”ëœë“œ ë¼ë²¤ë‹¤ì•¤ê·¸ë¦°í‹°ë¡œì¦ˆê°€ë“ ì—­	1
ì²­ì‚¬í¬ ìˆ˜ë¯¼ì´ë„¤	1
ì œì£¼ëª¬íŠ¸ë½	1
Jeju National University	1
ë””ìŠ¤ì´ì¦ˆí•«	1
1027 rows Ã— 1 columns
'''
```

- ì €ì¥

```python
location_counts_df.to_excel('./files/3_location_counts.xlsx', index = True)
```

- ìœ„ì¹˜ì •ë³´ ì¢…ë¥˜ í™•ì¸

```python
locations = list(location_counts_df.index)
```

---



## 10.2. ì¹´ì¹´ì˜¤ APIë¥¼ í™œìš©í•œ ì¥ì†Œ ê²€ìƒ‰

- ì¹´ì¹´ì˜¤ API ë°›ê¸°
- https://developers.kakao.com/console/app
- ì¹´ì¹´ì˜¤ ì•„ì´ë””ë¡œ ë¡œê·¸ì¸ í›„, ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë“¤ì–´ê°€ì„œ ì¶”ê°€
- REST API í‚¤ë¥¼ ë³µì‚¬í•´ì„œ ì•„ë˜ API ê°’ì— ì ìš©

```python
import requests
# ì•ˆë˜ë©´
# ! pip install requests
url = 'http://dapi.kakao.com/v2/local/search/keyword.json?query={}'.format(searching)
url
'''
'http://dapi.kakao.com/v2/local/search/keyword.json?query=í•©ì • ìŠ¤íƒ€ë²…ìŠ¤'
'''

headers = {
    "Authorization": "KakaoAK ì—¬ê¸°ì— ì¹´ì¹´ì˜¤ APIí‚¤ ì…ë ¥"
    # ì…ë ¥ì‹œ KakaoAK ë’¤ì— í•œ ì¹¸ ë„ìš°ê³  API ê°’ ì…ë ¥í•˜ì„¸ìš”
}

places = requests.get(url, headers= headers).json()['documents']
places[0]['place_name']
print('ê²½ë„= '  ,places[0]['x'])
print('ìœ„ë„= '  ,places[0]['y'])
# ìµœì†Œ ì†Œìˆ˜ì  6ì§¸ ìë¦¬ê¹Œì§€ ì¨ì£¼ëŠ”ê²Œ ì˜¤ì°¨ê°€ ì ì–´ì„œ ì¢‹ë‹¤.
'''
ê²½ë„=  126.91253700818196
ìœ„ë„=  37.54994959743763
'''
```

#### 10.2.1. API í™œìš©í•œ ì¥ì†Œ ê²€ìƒ‰ í•¨ìˆ˜ ë§Œë“¤ê¸°

```python
def find_places(searching):
    # ì ‘ì† URL 
    url = 'http://dapi.kakao.com/v2/local/search/keyword.json?query={}'.format(searching)
    # headers ì…ë ¥
    headers = {
    "Authorization": "KakaoAK ****************************" # ê°œì¸ì •ë³´ë¼ *ë¡œ í‘œê¸°í–ˆìŠµë‹ˆë‹¤.
    }
    # API ìš”ì²­ ë° ì •ë³´ ë°›ê¸°
    places = requests.get(url, headers= headers).json()['documents']
    # í•„ìš”í•œ ì •ë³´ ì„ íƒ
    place = places[0]
    name = place['place_name']
    x = place['x']
    y = place['y']
    
    data = [name, x, y, searching]
    
    return(data)
```

- ì˜ˆì‹œë¡œ í™œìš©í•´ë³´ê¸°

```python
data = find_places('ì œì£¼ê³µí•­')
data
'''
['ì œì£¼êµ­ì œê³µí•­', '126.492769004244', '33.5070789578184', 'ì œì£¼ê³µí•­']
'''
```

## 10.3. í•¨ìˆ˜ í™œìš©

#### 10.3.1. ì¸ìŠ¤íƒ€ê·¸ë¨ ìœ„ì¹˜ëª… ìœ„ì¹˜ì •ë³´ ê²€ìƒ‰í•˜ê¸°

```python
#ì–‘ì´ ë§ì„ ë•Œ í˜„ì¬ ì§„í–‰ìƒí™© ë³´ëŠ” ë°©ë²•
from tqdm.notebook import tqdm
# ! pip install tqdm
```

 ```python
 import time
 #í™•ì¸
 locations_inform = []
 # ë§ìœ¼ë‹ˆê¹Œ 200ê°œë§Œ ëŒë ¤ë³´ì # í™•ì¸ í›„ ë˜ë©´ ë‚˜ì¤‘ì— ì „ë¶€ ëŒë ¤ë³´ì„¸ìš”!
 for location in tqdm(locations[:200]):
     try:
         data = find_places(location)
         locations_inform.append(data)
         time.sleep(1)
     
     except:
         pass
 
     
 locations_inform
 ```

#### 10.3.2. ìœ„ì¹˜ì •ë³´ ì €ì¥

```python
# ì €ì¥í•  ë• ëª¨ë‘ ëŒë¦° í›„ ì €ì¥
locations_inform_df = pd.DataFrame(locations_inform)
locations_inform_df.columns = ['name_office', 'ê²½ë„','ìœ„ë„','name']
locations_inform_df.head()

locations_inform_df.to_excel('./files/3_locations.xlsx', index=False)
```

#### 10.3.3. ì¸ìŠ¤íƒ€ ê²Œì‹œëŸ‰ ë° ìœ„ì¹˜ì •ë³´ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

```python
location_counts_df = pd.read_excel('./files/3_location_counts.xlsx', index_col = 0)
location_inform_df = pd.read_excel('./files/3_locations.xlsx')
```

#### 10.3.4. ìœ„ì¹˜ ë°ì´í„° ë³‘í•©

```python
location_data = pd.merge(location_inform_df,
                        location_counts_df, how = 'inner', # inner êµì§‘í•©ì´ ìˆëŠ”ê²ƒë§Œ
                        left_on = 'name_official',
                        right_index = True)

location_data.head()
'''
	name_official	ê²½ë„	ìœ„ë„	ì¸ìŠ¤íƒ€ìœ„ì¹˜ëª…	place
1	ì„œê·€í¬ì ìˆ˜í•¨	126.558616	33.239303	Seogwipo	1
308	ì„œê·€í¬ì ìˆ˜í•¨	126.558616	33.239303	ì„œê·€í¬ì ìˆ˜í•¨	1
3	í• ë¡œë¹„ì¹˜	127.020826	37.518211	í• ë¡œë¹„ì¹˜	51
4	ì œì£¼ì—ì¸ê°ê·¤ë°­	126.539410	33.256610	ì œì£¼ì—ì¸ê°ê·¤ë°­	48
5	ì œì£¼ë„	126.545876	33.379777	Jeju Island	4
'''
```

#### 10.3.5. ì¤‘ë³µ ë°ì´í„° í™•ì¸

```python
# ì¤‘ë³µ ë°ì´í„° í™•ì¸
location_data['name_official'].value_counts()
'''
ì˜¤ì„¤ë¡í‹°ë®¤ì§€ì—„           3
ì„œê·€í¬ì ìˆ˜í•¨            2
ì²œì§€ì—°í­í¬             2
ë¹Œë¼ë“œì•„í†              2
ë¹„ìë¦¼               2
                 ..
íˆ¬ì¸í”Œë ˆì´ìŠ¤ ì œì£¼ì• ì›”í•œë‹´ì     1
í•˜ëŠ˜ê³ ë˜              1
ë¬¸ì˜                1
ì„±ì‚°ì¼ì¶œë´‰             1
ì‹ í’ëª©ì¥              1
Name: name_official, Length: 416, dtype: int64
'''
```

#### 10.3.6. ì¥ì†Œ ì´ë¦„ ê¸°ì¤€ ë³‘í•©

```python
# ì¤‘ë³µ í•©ì¹˜ê¸°
location_data = location_data.pivot_table(values = 'place',
                         index = ['name_official', 'ê²½ë„','ìœ„ë„'],
                         aggfunc= 'sum')
location_data.sort_values(by= 'place', ascending = False)

'''
			place
name_official	ê²½ë„	ìœ„ë„	
í• ë¡œë¹„ì¹˜	127.020826	37.518211	51
ì œì£¼ì—ì¸ê°ê·¤ë°­	126.539410	33.256610	48
ì„ë¶€ì‘ë°•ë¬¼ê´€	126.536502	33.250403	36
ìœ„ë¯¸ë™ë°±ë‚˜ë¬´êµ°ë½	126.674731	33.272939	18
ì„œìš°ë´‰	126.677894	33.545843	16
...	...	...	...
ì‚°ë°©ì‚°	126.313425	33.241304	1
ì‚¬ì´ì¹´ë ˆ	126.381107	33.484245	1
ì‚¬ë½	126.307741	33.228771	1
ë½•ë„ë‘	126.555112	33.243034	1
í‘ì†¡	129.196513	35.175011	1
416 rows Ã— 1 columns
'''
```

#### 10.3.7. ë³‘í•© ë°ì´í„° ì €ì¥í•˜ê¸°

```python
location_data.to_excel('./files/3_location_inform.xlsx')
```

---



## 10.4. foliumì„ ì´ìš©í•œ ì§€ë„ ì‹œê°í™” 

#### 10.4.1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

- ì €ì¥í•˜ê¸° ì „ location_dataì˜ info()ë¥¼ í™•ì¸í•´ë³´ë©´, columnì´ placeë§Œ ë‚˜ì˜¨ë‹¤
- í•˜ì§€ë§Œ ì—‘ì…€ì— ì €ì¥ í›„ ë¶ˆëŸ¬ì˜¤ë©´ ë‹¤ì‹œ columnì— ëª¨ë‘ ë“¤ì–´ê°„ë‹¤

```python
location_data = pd.read_excel('./files/3_location_inform.xlsx')
location_data.info()
'''
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 416 entries, 0 to 415
Data columns (total 4 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   name_official  416 non-null    object 
 1   ê²½ë„             416 non-null    float64
 2   ìœ„ë„             416 non-null    float64
 3   place          416 non-null    int64  
dtypes: float64(2), int64(1), object(1)
memory usage: 13.1+ KB
'''
```

 ```python
 # ì •ë¦¬ í•œë²ˆ
 location_data = location_data.sort_values(by= 'place', ascending = False)
 ```

#### 10.4.2. ì‹œê°í™” ì—°ìŠµ

```python
# ì•ˆë˜ë©´ ! pip install folium 
# ì§€ë„ ê·¸ë ¤ì£¼ëŠ” íˆ´ leaflet. jsì—ì„œ ë‚˜ì˜¨ê²ƒ. ìì£¼ ì“°ì„!
import folium 
```


```python
# ì‚¬ìš©ë²•
# ê¸°ë³¸ì¢Œí‘œ 
latitude = 37.394946
longitude = 127.111104

m = folium.Map(location = [latitude, longitude], #ì´ë¯¸ì§€ ì„¼í„° ì´ì•¼ê¸°
              width = 700,
              height = 300,
              zoom_start = 15)
#ë§ˆì»¤ ì¶”ê°€
folium.Marker(location = [latitude, longitude], # ì›í•˜ëŠ” ë§ˆì»¤ ìœ„ì¹˜ (ìœ„ë‘ ê°™ì€ë° ë„£ì€ê²ƒ ë¿)
              # popupì„ í´ë¦­í•˜ë©´ ëœ¸. ìœ íŠœë¸Œ ì†ŒìŠ¤ì½”ë“œë‚˜, í•˜ì´í¼ë§í¬, ì¼ë°˜ ë¬¸ì ëª¨ë“œ ê°€ëŠ¥
             popup = '<iframe width="640" height="360" src="https://www.youtube.com/embed/VMQl78z1DiY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>', # í´ë¦­í•˜ë©´ ëœ¨ëŠ”ê±°
             tooltip= 'íŒêµì—­ ì…êµ¬', # ì»¤ì„œ ì˜¬ë ¤ë‘ë©´ ëœ¨ëŠ”ê±°
             icon = folium.Icon(color = 'red', # ì•„ì´ì½˜ ì¶”ê°€ì™€ ë°”ê¹¥ìª½ ìƒ‰ ì¶”ê°€
                               icon_color= 'white', # ì•„ì´ì½˜ ì•ˆìª½ ìƒ‰
                               icon = 'subway', # ì•„ì´ì½˜ ëª¨ì–‘
                               prefix = 'fa')).add_to(m) #faëŠ” ì•„ì´ì½˜ ê°€ì ¸ì˜¨ ì‚¬ì´íŠ¸ https://fontawesome.com/v5.15/icons?d=gallery&p=2&q=subway

folium.CircleMarker(location= [latitude, longitude], # ì›ë„£ê¸°
                   color='tomato',
                   radius = 50, # ë³€ìˆ˜ë¥¼ ì§ì ‘ ë„£ì„ ìˆ˜ ìˆìŒ
                   tooltip = 'í™œë™ë°˜ê²½',
                   ).add_to(m)


m
```

![image-20220118180959317](image.assets/image-20220118180959317.png)

#### 10.4.3. ì‹œê°í•´ í•´ë³´ê¸°

```python
location_data =pd.read_excel('./files/3_location_inform.xlsx')
location_data.info()
'''
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 417 entries, 0 to 416
Data columns (total 4 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   name_official  416 non-null    object 
 1   ê²½ë„             417 non-null    float64
 2   ìœ„ë„             417 non-null    float64
 3   place          417 non-null    int64  
dtypes: float64(2), int64(1), object(1)
memory usage: 13.2+ KB
'''
location_data.head()
'''
	name_official	ê²½ë„	ìœ„ë„	place
0	73st	126.455109	33.456989	1
1	ê°€ë“œë§ì œ	126.532954	33.500991	1
2	ê°€ë°°	126.505570	33.231541	1
3	ê°€ì‹œì‹ë‹¹	126.771438	33.353060	2
4	ê°€ì‹œì•„ë°©êµ­ìˆ˜	126.918072	33.438605	2
'''
```

```python
import folium

Mt_Hanla = [33.362500, 126.533694]
map_jeju = folium.Map(location = Mt_Hanla,
                      zoom_start = 10)

# folium.TileLayer('ì›í•˜ëŠ” í˜•ì‹').add_to(map_jeju) # ì§€ë„ í‘œí˜„í˜•ì‹ ë°”ê¾¸ê¸°
# https://deparkes.co.uk/2016/06/10/folium-map-tiles/

# len  ëŒ€ì‹  location_data.shape[0] ë„ ê°€ëŠ¥
for i in range(len(location_data)):
    name = location_data['name_official'][i]
    count = location_data['place'][i]
    size = int(count*2)
    lng = location_data['ê²½ë„'][i]
    lat = location_data['ìœ„ë„'][i]
    folium.CircleMarker(location = [lat, lng],
                       radius = size,
                       color = 'red',
                       popup = name).add_to(map_jeju)
    
map_jeju
```



![image-20220118182004105](image.assets/image-20220118182004105.png)

- ì €ì¥

```python
map_jeju.save('./files/3_jeju.html')
```

#### 10.4.4. ë³´ê¸° ë” ì¢‹ê²Œ ë°”ê¿”ë³´ê¸°

```python
from folium.plugins import MarkerCluster
```

```python
locations = []
names = []

for i in range(len(location_data)):
    data = location_data.iloc[i]
    locations.append([data['ìœ„ë„'], data['ê²½ë„']])
    names.append(data['name_official'])
    
# locations
# names

Mt_Hanla = [33.362500, 126.533694]
map_jeju2 = folium.Map(location = Mt_Hanla,
                      zoom_start = 10)

tiles = ['stamenwatercolor', 'cartodbpositron', 
         'openstreetmap', 'stamenterrain']

for tile in tiles:
    folium.TileLayer(tile).add_to(map_jeju2)
    
    
marker_cluster = MarkerCluster(locations = locations,
                            popups = names,
                            name = 'Jeju',
                            overlay = True, 
                            control = True
                            ).add_to(map_jeju2)

folium.LayerControl().add_to(map_jeju2)
map_jeju2

```



![image-20220118182225687](image.assets/image-20220118182225687.png)

- ê°€ê¹Œì´ ê°€ë©´ ìœ„ì¹˜ë³„ë¡œ ë¶„í• ë˜ì–´ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤
- í´ë¦­ìœ¼ë¡œ ì´ë™ë„ ê°€ëŠ¥í•˜ë‹¤ 
- ì˜¤ë¥¸ìª½ ìœ„ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìœ„ì— ì…ë ¥í•œ ë‹¤ì–‘í•œ ì§€ë„ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ë„ ê°€ëŠ¥í•˜ë‹¤

- ì €ì¥

```python
map_jeju2.save('./files/3_jeju2.html')
```



---





## 10.5. íŠ¹ì • ë‹¨ì–´ ê²Œì‹œê¸€ ì°¾ê¸°

#### 10.5.1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

```python

raw_total = pd.read_excel('./files/1_crawling_raw.xlsx')
raw_total
'''
ìƒëµ
'''
```

#### 10.5.2. ë‹¨ì–´ ì„ íƒ

```python
select_word = 'í•´ë‹ì´'

check_list = []

for content in raw_total['content']:
    if select_word in content:
        check_list.append(True)
    else:
        check_list.append(False)

check_list # True ì™€ Falseê°’ì´ ë“¤ì–´ìˆë‹¤
select_df = raw_total[check_list] # Trueê°’ì„ ê°€ì§„ raw_total ì¶”ì¶œ
select_df['content']

```

```python
# for ë¬¸ìœ¼ë¡œ ëª©ì ì— ë”°ë¥¸ ì •ë³´ ì¶”ì¶œ

for i in select_df.index:
    print(select_df.loc[i, 'content'])
    print('-'*50) # êµ¬ë¶„í•˜ê¸° ìœ„í•´
```

#### 10.5.3. í•¨ìˆ˜í™”

```python
select_word_list = ['í•´ë‹ì´', 'ë°•ë¬¼ê´€','íë§','ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤','ì„­ì§€ì½”ì§€']

check_list = []

def select_word(select_word_list):
    for select_word in select_word_list:
        check_list = []
        for content in raw_total['content']:
            if select_word in content:
                check_list.append(True)
            else:
                check_list.append(False)
    
        select_df = raw_total[check_list]
        fpath = './files/4_select_data_{}.xlsx'.format(select_word)
        select_df.to_excel(fpath, index = False)

```

```python
select_word_list = ['í•´ë‹ì´', 'ë°•ë¬¼ê´€','íë§','ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤','ì„­ì§€ì½”ì§€']
select_word(select_word_list)
```

- ì €ì¥ëœê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
